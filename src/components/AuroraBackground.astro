---
// Aurora Background компонент для главной страницы
const { showRadialGradient = true } = Astro.props;
---

<!-- Задаем уникальный ID, чтобы скрипт мог легко найти элемент -->
<div id="aurora-portal" class="aurora-background-wrapper">
  <div class="aurora-background-inner">
    <div class:list={["aurora-effect", { "show-radial": showRadialGradient }]}></div>
  </div>
</div>

<style>
  .aurora-background-wrapper {
    /* Обязательно fixed */
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    margin: 0 !important;
    padding: 0 !important;
    overflow: hidden;
    pointer-events: none;
    /* Устанавливаем базовый z-index */
    z-index: 0 !important;
  }

  .aurora-background-inner {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 150vw; 
    height: 150vh;
  }

  .aurora-effect {
    position: absolute;
    inset: 0;
    
    --white-gradient: repeating-linear-gradient(100deg, var(--white) 0%, var(--white) 6%, var(--transparent) 9%, var(--transparent) 11%, var(--white) 14%);
    --dark-gradient: repeating-linear-gradient(100deg, var(--black) 0%, var(--black) 6%, var(--transparent) 9%, var(--transparent) 11%, var(--black) 14%);
    --aurora: repeating-linear-gradient(100deg, var(--blue-500) 8%, var(--indigo-300) 12%, var(--blue-300) 16%, var(--violet-200) 20%, var(--blue-400) 24%);
    
    background-image: var(--dark-gradient), var(--aurora);
    background-size: 200%, 140%;
    background-position: 50% 50%, 50% 50%;
    
    filter: blur(10px);
    opacity: 0.25;
    pointer-events: none;
  }

  .aurora-effect.show-radial {
    mask-image: radial-gradient(ellipse at 100% 0%, black 10%, transparent 48%);
    -webkit-mask-image: radial-gradient(ellipse at 100% 0%, black 10%, transparent 48%);
  }

  .aurora-effect::after {
    content: '';
    position: absolute;
    inset: -50%; 
    
    background-image: var(--dark-gradient), var(--aurora);
    background-size: 80%, 60%;
    background-position: center;
    
    mix-blend-mode: difference;
    
    will-change: transform;
    animation: aurora-gpu 20s ease-in-out infinite;
    opacity: 0.6;
  }

  :root[data-theme="light"] .aurora-effect {
    background-image: var(--white-gradient), var(--aurora);
    filter: blur(10px) invert(1);
    opacity: 0.3;
  }

  :root[data-theme="light"] .aurora-effect::after {
    background-image: var(--white-gradient), var(--aurora);
  }

  :root:not([data-theme="light"]) .aurora-effect {
    filter: blur(10px) invert(0);
  }

  @keyframes aurora-gpu {
    0%, 100% {
      transform: translate3d(0, 0, 0);
    }
    50% {
      transform: translate3d(-10%, -10%, 0);
    }
  }
</style>

<script>
  // Этот скрипт выполнится на клиенте
  document.addEventListener('DOMContentLoaded', () => {
    const aurora = document.getElementById('aurora-portal');
    if (aurora) {
      // 1. Вырываем элемент из дерева Starlight и вставляем прямо в body
      // Это чинит position: fixed при скроллинге
      document.body.appendChild(aurora);
    }
  });
</script>
